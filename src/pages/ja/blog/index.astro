---
import JaBaseLayout from "../../../layouts/JaBaseLayout.astro";
import { getCollection } from "astro:content";

const entries = await getCollection("blog", ({ data }) => {
  return data.locale === "ja" && !data.draft;
});

entries.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());

const toBlogUrl = (entry: typeof entries[number]) => {
  // entry.slug looks like: "ja/my-first-post"
  const slugWithoutLocale = entry.slug.replace(/^ja\//, "");
  return `/ja/blog/${slugWithoutLocale}`;
};
---

<JaBaseLayout>
  <h1>ブログ</h1>

  {entries.length === 0 ? (
    <p>まだ投稿がありません。</p>
  ) : (
    <ul>
      {entries.map((entry) => (
        <li>
          <a href={toBlogUrl(entry)}>{entry.data.title}</a>
          {entry.data.description ? <div>{entry.data.description}</div> : null}
          <small>{entry.data.pubDate.toISOString().slice(0, 10)}</small>
        </li>
      ))}
    </ul>
  )}
</JaBaseLayout>
